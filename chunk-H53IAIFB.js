import{c as $}from"./chunk-V4R3QUZD.js";import{a as W,b as X}from"./chunk-CZSGPQFT.js";import{a as N,c as V}from"./chunk-7GC3BAAQ.js";import{a as R,b as A,c as L,l as j,m as q}from"./chunk-DCY57EI2.js";import"./chunk-S6TQN5V4.js";import{a as G,b as K,c as Z,d as J,e as Q,f as U}from"./chunk-TFOK2HCO.js";import{J as H,K as z}from"./chunk-DPOEUPYJ.js";import{Db as D,Fb as k,Gb as s,Ra as o,Rb as I,Tb as c,Ub as h,Vb as C,_ as b,ac as g,da as v,dc as B,ea as P,eb as y,pa as O,rb as p,sb as u,ub as T,vb as F,wb as M,xb as a,yb as r,zb as f}from"./chunk-U2MXLZLO.js";var S=["#1976d2","#d32f2f","#388e3c","#f57c00","#7b1fa2","#0097a7","#c2185b","#455a64"],E=class n{supermarkets=B.required();chartData=g(()=>{let t=this.supermarkets(),e=new Set;for(let m of t)for(let _ of m.fullPriceHistory)e.add(_.timestamp);let i=Array.from(e).sort((m,_)=>m-_),d=i.map(m=>new Date(m).toLocaleDateString("en-GB",{day:"2-digit",month:"short"})),l=t.map((m,_)=>{let tt=new Map(m.fullPriceHistory.map(x=>[x.timestamp,x.price])),et=i.map(x=>{let w=tt.get(x);return w!==void 0?w/100:null});return{label:m.brand,data:et,borderColor:S[_%S.length],backgroundColor:S[_%S.length]+"33",tension:.3,spanGaps:!0,pointRadius:4,pointHoverRadius:6}});return{labels:d,datasets:l}});chartOptions={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:t=>{let e=t.parsed.y;return e!==null?`${t.dataset.label}: \u20AC${e.toFixed(2)}`:""}}}},scales:{y:{beginAtZero:!1,ticks:{callback:t=>`\u20AC${Number(t).toFixed(2)}`}}}};static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["pw-price-chart"]],inputs:{supermarkets:[1,"supermarkets"]},decls:2,vars:2,consts:[[1,"chart-container"],["baseChart","","type","line",3,"data","options"]],template:function(e,i){e&1&&(a(0,"div",0),f(1,"canvas",1),r()),e&2&&(o(),M("data",i.chartData())("options",i.chartOptions))},dependencies:[$],styles:[".chart-container[_ngcontent-%COMP%]{position:relative;width:100%;height:280px}"]})};var at=(n,t)=>t.brand;function rt(n,t){if(n&1&&(a(0,"div",4)(1,"span",8),c(2,"Best Full Price"),r(),a(3,"span",9),c(4),r(),a(5,"span",10),c(6),r()()),n&2){let e=t,i=s(2);o(4),C(" ",i.formatCentsToEuro(e.price.price)," "),o(2),C("@ ",e.brand)}}function ot(n,t){if(n&1&&(a(0,"div",5)(1,"span",8),c(2,"Best Deal"),r(),a(3,"span",9),c(4),r(),a(5,"span",10),c(6),r()()),n&2){let e=t,i=s(2);o(4),C(" ",i.formatCentsToEuro(e.price.price)," "),o(2),C("@ ",e.brand)}}function ct(n,t){if(n&1&&(a(0,"span",15),c(1),r()),n&2){let e=s(3);o(),h(e.formatCentsToEuro(t.price))}}function dt(n,t){if(n&1&&(a(0,"span",16),c(1),r()),n&2){let e=s().$implicit,i=s(2);o(),C(" ",i.formatCentsToEuro(e.discountedPrice.price)," ")}}function st(n,t){if(n&1){let e=D();a(0,"button",20),k("click",function(){v(e);let d=s().$implicit,l=s(2);return P(l.removeDiscount(d.brand))}),a(1,"mat-icon"),c(2,"remove_shopping_cart"),r()()}}function lt(n,t){if(n&1){let e=D();a(0,"div",11)(1,"div",12)(2,"span",13),c(3),r(),a(4,"div",14),p(5,ct,2,1,"span",15),p(6,dt,2,1,"span",16),r()(),a(7,"div",17)(8,"button",18),k("click",function(){let d=v(e).$implicit,l=s(2);return P(l.updatePrice(d.brand))}),a(9,"mat-icon"),c(10,"edit"),r()(),p(11,st,3,0,"button",19),r()()}if(n&2){let e,i=t.$implicit,d=s(2);I("highlighted",d.highlightedBrand()&&i.brand.toLowerCase()===d.highlightedBrand().toLowerCase()),o(3),h(i.brand),o(2),u((e=d.getCurrentFullPrice(i))?5:-1,e),o(),u(i.discountedPrice?6:-1),o(5),u(i.discountedPrice?11:-1)}}function mt(n,t){if(n&1&&(a(0,"h3"),c(1,"Price History"),r(),f(2,"pw-price-chart",21)),n&2){let e=s();o(2),M("supermarkets",e.supermarkets)}}function pt(n,t){if(n&1){let e=D();a(0,"div",0)(1,"h2"),c(2),r(),a(3,"p",2),c(4),r(),a(5,"div",3),p(6,rt,7,2,"div",4),p(7,ot,7,2,"div",5),r(),f(8,"mat-divider"),a(9,"h3"),c(10,"Prices by Supermarket"),r(),T(11,lt,12,6,"div",6,at),a(13,"button",7),k("click",function(){v(e);let d=s();return P(d.addNewSupermarketPrice())}),a(14,"mat-icon"),c(15,"add"),r(),c(16," Add Supermarket "),r(),f(17,"mat-divider"),p(18,mt,3,1),r()}if(n&2){let e,i,d=t,l=s();o(2),h(d.name),o(2),h(d.barcode),o(2),u((e=l.cheapestFull())?6:-1,e),o(),u((i=l.cheapestDiscounted())?7:-1,i),o(4),F(l.sortedSupermarkets()),o(7),u(d.supermarkets.length>0?18:-1)}}function ut(n,t){n&1&&(a(0,"div",1)(1,"p"),c(2,"Product not found."),r()())}var Y=class n{route=b(N);router=b(V);storage=b(U);snackBar=b(j);barcode=O("");highlightedBrand=O("");product=g(()=>{let t=this.barcode();return t?this.storage.products().find(e=>e.barcode===t)??null:null});sortedSupermarkets=g(()=>{let t=this.product();return t?Q(t.supermarkets):[]});cheapestFull=g(()=>{let t=this.product();return t?K(t):null});cheapestDiscounted=g(()=>{let t=this.product();return t?Z(t):null});formatCentsToEuro=J;getCurrentFullPrice=G;ngOnInit(){this.barcode.set(this.route.snapshot.paramMap.get("barcode")??""),this.highlightedBrand.set(this.route.snapshot.queryParamMap.get("brand")??"")}addNewSupermarketPrice(){this.router.navigate(["/product",this.barcode(),"edit"])}updatePrice(t){this.router.navigate(["/product",this.barcode(),"edit",t])}removeDiscount(t){this.storage.removeDiscountedPrice(this.barcode(),t),this.snackBar.open(`Discount removed for ${t}`,"OK",{duration:2e3})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=y({type:n,selectors:[["pw-product-detail"]],decls:2,vars:1,consts:[[1,"detail-page","page-content"],[1,"page-content"],[1,"barcode-label"],[1,"price-badges"],[1,"badge","full-badge"],[1,"badge","discount-badge"],[1,"sm-entry",3,"highlighted"],["mat-stroked-button","",1,"add-sm-btn",3,"click"],[1,"badge-label"],[1,"badge-price"],[1,"badge-brand"],[1,"sm-entry"],[1,"sm-header"],[1,"sm-brand"],[1,"sm-prices"],[1,"full-price"],[1,"discounted-price"],[1,"sm-actions"],["mat-icon-button","","aria-label","Edit price",3,"click"],["mat-icon-button","","aria-label","Remove discount"],["mat-icon-button","","aria-label","Remove discount",3,"click"],[3,"supermarkets"]],template:function(e,i){if(e&1&&p(0,pt,19,5,"div",0)(1,ut,3,0,"div",1),e&2){let d;u((d=i.product())?0:1,d)}},dependencies:[L,A,R,z,H,X,W,q,E],styles:[".detail-page[_ngcontent-%COMP%]{max-width:500px;margin:0 auto}.barcode-label[_ngcontent-%COMP%]{font-family:monospace;color:var(--mat-sys-on-surface-variant);margin-bottom:16px}.price-badges[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin:16px 0}.badge[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:12px;border-radius:12px}.badge[_ngcontent-%COMP%]   .badge-label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.05em}.badge[_ngcontent-%COMP%]   .badge-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.badge[_ngcontent-%COMP%]   .badge-brand[_ngcontent-%COMP%]{font-size:.875rem}.full-badge[_ngcontent-%COMP%]{background:var(--mat-sys-primary-container);color:var(--mat-sys-on-primary-container)}.discount-badge[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary-container);color:var(--mat-sys-on-tertiary-container)}.sm-entry[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px;margin:4px 0;border-radius:8px;background:var(--mat-sys-surface-container-low)}.sm-entry.highlighted[_ngcontent-%COMP%]{background:var(--mat-sys-secondary-container);border-left:4px solid var(--mat-sys-primary)}.sm-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.sm-brand[_ngcontent-%COMP%]{font-weight:500}.sm-prices[_ngcontent-%COMP%]{display:flex;gap:12px}.full-price[_ngcontent-%COMP%]{color:var(--mat-sys-primary);font-weight:500}.discounted-price[_ngcontent-%COMP%]{color:var(--mat-sys-error);font-weight:500}.sm-actions[_ngcontent-%COMP%]{display:flex}.add-sm-btn[_ngcontent-%COMP%]{width:100%;margin:16px 0}mat-divider[_ngcontent-%COMP%]{margin:16px 0}"]})};export{Y as ProductDetail};
