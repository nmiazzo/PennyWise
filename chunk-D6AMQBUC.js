import{c as R}from"./chunk-V4R3QUZD.js";import{a as X,b as Y}from"./chunk-CZSGPQFT.js";import{a as V,c as $}from"./chunk-7GC3BAAQ.js";import{a as A,b as L,c as H,l as q,m as G}from"./chunk-DCY57EI2.js";import"./chunk-S6TQN5V4.js";import{a as K,b as Z,c as J,d as Q,e as U,f as W}from"./chunk-H4KNKKFH.js";import{J as z,K as j}from"./chunk-DPOEUPYJ.js";import{Db as k,Fb as S,Gb as s,Ra as o,Rb as B,Tb as d,Ub as h,Vb as b,_ as C,ac as _,da as P,dc as N,ea as y,eb as D,pa as O,rb as p,sb as u,ub as F,vb as I,wb as M,xb as a,yb as r,zb as f}from"./chunk-U2MXLZLO.js";var w=["#1976d2","#d32f2f","#388e3c","#f57c00","#7b1fa2","#0097a7","#c2185b","#455a64"];function re(n){let e=new Date(n);return e.setHours(0,0,0,0),e.getTime()}var E=class n{supermarkets=N.required();chartData=_(()=>{let e=this.supermarkets(),t=[],i=new Set;for(let g of e){let m=new Map;for(let x of g.fullPriceHistory){let v=re(x.timestamp);m.set(v,x.price),i.add(v)}t.push(m)}let c=Array.from(i).sort((g,m)=>g-m),l=c.map(g=>new Date(g).toLocaleDateString("en-GB",{day:"2-digit",month:"short"})),te=e.map((g,m)=>{let x=t[m],v=c.map(ne=>{let T=x.get(ne);return T!==void 0?T/100:null});return{label:g.brand,data:v,borderColor:w[m%w.length],backgroundColor:w[m%w.length]+"33",tension:.3,spanGaps:!0,pointRadius:4,pointHoverRadius:6}});return{labels:l,datasets:te}});chartOptions={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:e=>{let t=e.parsed.y;return t!==null?`${e.dataset.label}: \u20AC${t.toFixed(2)}`:""}}}},scales:{y:{beginAtZero:!1,ticks:{callback:e=>`\u20AC${Number(e).toFixed(2)}`}}}};static \u0275fac=function(t){return new(t||n)};static \u0275cmp=D({type:n,selectors:[["pw-price-chart"]],inputs:{supermarkets:[1,"supermarkets"]},decls:2,vars:2,consts:[[1,"chart-container"],["baseChart","","type","line",3,"data","options"]],template:function(t,i){t&1&&(a(0,"div",0),f(1,"canvas",1),r()),t&2&&(o(),M("data",i.chartData())("options",i.chartOptions))},dependencies:[R],styles:[".chart-container[_ngcontent-%COMP%]{position:relative;width:100%;height:280px}"]})};var oe=(n,e)=>e.brand;function ce(n,e){if(n&1&&(a(0,"div",4)(1,"span",8),d(2,"Best Full Price"),r(),a(3,"span",9),d(4),r(),a(5,"span",10),d(6),r()()),n&2){let t=e,i=s(2);o(4),b(" ",i.formatCentsToEuro(t.price.price)," "),o(2),b("@ ",t.brand)}}function de(n,e){if(n&1&&(a(0,"div",5)(1,"span",8),d(2,"Best Deal"),r(),a(3,"span",9),d(4),r(),a(5,"span",10),d(6),r()()),n&2){let t=e,i=s(2);o(4),b(" ",i.formatCentsToEuro(t.price.price)," "),o(2),b("@ ",t.brand)}}function se(n,e){if(n&1&&(a(0,"span",15),d(1),r()),n&2){let t=s(3);o(),h(t.formatCentsToEuro(e.price))}}function le(n,e){if(n&1&&(a(0,"span",16),d(1),r()),n&2){let t=s().$implicit,i=s(2);o(),b(" ",i.formatCentsToEuro(t.discountedPrice.price)," ")}}function me(n,e){if(n&1){let t=k();a(0,"button",20),S("click",function(){P(t);let c=s().$implicit,l=s(2);return y(l.removeDiscount(c.brand))}),a(1,"mat-icon"),d(2,"remove_shopping_cart"),r()()}}function pe(n,e){if(n&1){let t=k();a(0,"div",11)(1,"div",12)(2,"span",13),d(3),r(),a(4,"div",14),p(5,se,2,1,"span",15),p(6,le,2,1,"span",16),r()(),a(7,"div",17)(8,"button",18),S("click",function(){let c=P(t).$implicit,l=s(2);return y(l.updatePrice(c.brand))}),a(9,"mat-icon"),d(10,"edit"),r()(),p(11,me,3,0,"button",19),r()()}if(n&2){let t,i=e.$implicit,c=s(2);B("highlighted",c.highlightedBrand()&&i.brand.toLowerCase()===c.highlightedBrand().toLowerCase()),o(3),h(i.brand),o(2),u((t=c.getCurrentFullPrice(i))?5:-1,t),o(),u(i.discountedPrice?6:-1),o(5),u(i.discountedPrice?11:-1)}}function ue(n,e){if(n&1&&(a(0,"h3"),d(1,"Price History"),r(),f(2,"pw-price-chart",21)),n&2){let t=s();o(2),M("supermarkets",t.supermarkets)}}function ge(n,e){if(n&1){let t=k();a(0,"div",0)(1,"h2"),d(2),r(),a(3,"p",2),d(4),r(),a(5,"div",3),p(6,ce,7,2,"div",4),p(7,de,7,2,"div",5),r(),f(8,"mat-divider"),a(9,"h3"),d(10,"Prices by Supermarket"),r(),F(11,pe,12,6,"div",6,oe),a(13,"button",7),S("click",function(){P(t);let c=s();return y(c.addNewSupermarketPrice())}),a(14,"mat-icon"),d(15,"add"),r(),d(16," Add Supermarket "),r(),f(17,"mat-divider"),p(18,ue,3,1),r()}if(n&2){let t,i,c=e,l=s();o(2),h(c.name),o(2),h(c.barcode),o(2),u((t=l.cheapestFull())?6:-1,t),o(),u((i=l.cheapestDiscounted())?7:-1,i),o(4),I(l.sortedSupermarkets()),o(7),u(c.supermarkets.length>0?18:-1)}}function _e(n,e){n&1&&(a(0,"div",1)(1,"p"),d(2,"Product not found."),r()())}var ee=class n{route=C(V);router=C($);storage=C(W);snackBar=C(q);barcode=O("");highlightedBrand=O("");product=_(()=>{let e=this.barcode();return e?this.storage.products().find(t=>t.barcode===e)??null:null});sortedSupermarkets=_(()=>{let e=this.product();return e?U(e.supermarkets):[]});cheapestFull=_(()=>{let e=this.product();return e?Z(e):null});cheapestDiscounted=_(()=>{let e=this.product();return e?J(e):null});formatCentsToEuro=Q;getCurrentFullPrice=K;ngOnInit(){this.barcode.set(this.route.snapshot.paramMap.get("barcode")??""),this.highlightedBrand.set(this.route.snapshot.queryParamMap.get("brand")??"")}addNewSupermarketPrice(){this.router.navigate(["/product",this.barcode(),"edit"])}updatePrice(e){this.router.navigate(["/product",this.barcode(),"edit",e])}removeDiscount(e){this.storage.removeDiscountedPrice(this.barcode(),e),this.snackBar.open(`Discount removed for ${e}`,"OK",{duration:2e3})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=D({type:n,selectors:[["pw-product-detail"]],decls:2,vars:1,consts:[[1,"detail-page","page-content"],[1,"page-content"],[1,"barcode-label"],[1,"price-badges"],[1,"badge","full-badge"],[1,"badge","discount-badge"],[1,"sm-entry",3,"highlighted"],["mat-stroked-button","",1,"add-sm-btn",3,"click"],[1,"badge-label"],[1,"badge-price"],[1,"badge-brand"],[1,"sm-entry"],[1,"sm-header"],[1,"sm-brand"],[1,"sm-prices"],[1,"full-price"],[1,"discounted-price"],[1,"sm-actions"],["mat-icon-button","","aria-label","Edit price",3,"click"],["mat-icon-button","","aria-label","Remove discount"],["mat-icon-button","","aria-label","Remove discount",3,"click"],[3,"supermarkets"]],template:function(t,i){if(t&1&&p(0,ge,19,5,"div",0)(1,_e,3,0,"div",1),t&2){let c;u((c=i.product())?0:1,c)}},dependencies:[H,L,A,j,z,Y,X,G,E],styles:[".detail-page[_ngcontent-%COMP%]{max-width:500px;margin:0 auto}.barcode-label[_ngcontent-%COMP%]{font-family:monospace;color:var(--mat-sys-on-surface-variant);margin-bottom:16px}.price-badges[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin:16px 0}.badge[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:12px;border-radius:12px}.badge[_ngcontent-%COMP%]   .badge-label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.05em}.badge[_ngcontent-%COMP%]   .badge-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.badge[_ngcontent-%COMP%]   .badge-brand[_ngcontent-%COMP%]{font-size:.875rem}.full-badge[_ngcontent-%COMP%]{background:var(--mat-sys-primary-container);color:var(--mat-sys-on-primary-container)}.discount-badge[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary-container);color:var(--mat-sys-on-tertiary-container)}.sm-entry[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px;margin:4px 0;border-radius:8px;background:var(--mat-sys-surface-container-low)}.sm-entry.highlighted[_ngcontent-%COMP%]{background:var(--mat-sys-secondary-container);border-left:4px solid var(--mat-sys-primary)}.sm-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.sm-brand[_ngcontent-%COMP%]{font-weight:500}.sm-prices[_ngcontent-%COMP%]{display:flex;gap:12px}.full-price[_ngcontent-%COMP%]{color:var(--mat-sys-primary);font-weight:500}.discounted-price[_ngcontent-%COMP%]{color:var(--mat-sys-error);font-weight:500}.sm-actions[_ngcontent-%COMP%]{display:flex}.add-sm-btn[_ngcontent-%COMP%]{width:100%;margin:16px 0}mat-divider[_ngcontent-%COMP%]{margin:16px 0}"]})};export{ee as ProductDetail};
