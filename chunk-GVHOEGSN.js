import{c as A}from"./chunk-V4R3QUZD.js";import{a as ce,b as de}from"./chunk-CZSGPQFT.js";import{a as ne,d as ie,e as ae,f as oe,g as re}from"./chunk-XPWQRXXX.js";import{a as B,c as $}from"./chunk-JYRBUVI2.js";import{a as R,b as L,c as H,l as q,m as G}from"./chunk-DCY57EI2.js";import"./chunk-S6TQN5V4.js";import{a as K,b as Z,c as J,d as Q,e as U,f as W,h as X,l as Y,o as ee,r as te}from"./chunk-V24SG72Y.js";import{J as z,K as j}from"./chunk-DPOEUPYJ.js";import{Db as b,Fb as h,Gb as l,Ra as c,Rb as F,Tb as d,Ub as D,Vb as v,_ as P,ac as C,da as m,dc as I,ea as p,eb as S,pa as y,rb as u,sb as _,ub as T,vb as V,wb as M,xb as a,yb as r,zb as x}from"./chunk-U2MXLZLO.js";var N=["#1976d2","#d32f2f","#388e3c","#f57c00","#7b1fa2","#0097a7","#c2185b","#455a64"];function _e(n){let e=new Date(n);return e.setHours(0,0,0,0),e.getTime()}var E=class n{supermarkets=I.required();chartData=C(()=>{let e=this.supermarkets(),t=[],i=new Set;for(let f of e){let g=new Map;for(let k of f.fullPriceHistory){let w=_e(k.timestamp);g.set(w,k.price),i.add(w)}t.push(g)}let o=Array.from(i).sort((f,g)=>f-g),s=o.map(f=>new Date(f).toLocaleDateString("en-GB",{day:"2-digit",month:"short"})),se=e.map((f,g)=>{let k=t[g],w=o.map(me=>{let O=k.get(me);return O!==void 0?O/100:null});return{label:f.brand,data:w,borderColor:N[g%N.length],backgroundColor:N[g%N.length]+"33",tension:.3,spanGaps:!0,pointRadius:4,pointHoverRadius:6}});return{labels:s,datasets:se}});chartOptions={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:e=>{let t=e.parsed.y;return t!==null?`${e.dataset.label}: \u20AC${t.toFixed(2)}`:""}}}},scales:{y:{beginAtZero:!1,ticks:{callback:e=>`\u20AC${Number(e).toFixed(2)}`}}}};static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["pw-price-chart"]],inputs:{supermarkets:[1,"supermarkets"]},decls:2,vars:2,consts:[[1,"chart-container"],["baseChart","","type","line",3,"data","options"]],template:function(t,i){t&1&&(a(0,"div",0),x(1,"canvas",1),r()),t&2&&(c(),M("data",i.chartData())("options",i.chartOptions))},dependencies:[A],styles:[".chart-container[_ngcontent-%COMP%]{position:relative;width:100%;height:280px}"]})};var ge=(n,e)=>e.brand;function fe(n,e){if(n&1){let t=b();a(0,"mat-form-field",2)(1,"mat-label"),d(2,"Product name"),r(),a(3,"input",10),h("ngModelChange",function(o){m(t);let s=l(2);return p(s.editNameValue.set(o))})("keydown.enter",function(){m(t);let o=l(2);return p(o.saveName())})("keydown.escape",function(){m(t);let o=l(2);return p(o.cancelEditName())})("blur",function(){m(t);let o=l(2);return p(o.saveName())}),r()()}if(n&2){let t=l(2);c(3),M("ngModel",t.editNameValue())}}function Ce(n,e){if(n&1){let t=b();a(0,"div",3)(1,"h2"),d(2),r(),a(3,"button",11),h("click",function(){m(t);let o=l(2);return p(o.startEditName())}),a(4,"mat-icon"),d(5,"edit"),r()()()}if(n&2){let t=l();c(2),D(t.name)}}function xe(n,e){if(n&1&&(a(0,"div",6)(1,"span",12),d(2,"Best Full Price"),r(),a(3,"span",13),d(4),r(),a(5,"span",14),d(6),r()()),n&2){let t=e,i=l(2);c(4),v(" ",i.formatCentsToEuro(t.price.price)," "),c(2),v("@ ",t.brand)}}function be(n,e){if(n&1&&(a(0,"div",7)(1,"span",12),d(2,"Best Deal"),r(),a(3,"span",13),d(4),r(),a(5,"span",14),d(6),r()()),n&2){let t=e,i=l(2);c(4),v(" ",i.formatCentsToEuro(t.price.price)," "),c(2),v("@ ",t.brand)}}function he(n,e){if(n&1&&(a(0,"span",19),d(1),r()),n&2){let t=l(3);c(),D(t.formatCentsToEuro(e.price))}}function ve(n,e){if(n&1&&(a(0,"span",20),d(1),r()),n&2){let t=l().$implicit,i=l(2);c(),v(" ",i.formatCentsToEuro(t.discountedPrice.price)," ")}}function Pe(n,e){if(n&1){let t=b();a(0,"button",24),h("click",function(){m(t);let o=l().$implicit,s=l(2);return p(s.removeDiscount(o.brand))}),a(1,"mat-icon"),d(2,"remove_shopping_cart"),r()()}}function ye(n,e){if(n&1){let t=b();a(0,"div",15)(1,"div",16)(2,"span",17),d(3),r(),a(4,"div",18),u(5,he,2,1,"span",19),u(6,ve,2,1,"span",20),r()(),a(7,"div",21)(8,"button",22),h("click",function(){let o=m(t).$implicit,s=l(2);return p(s.updatePrice(o.brand))}),a(9,"mat-icon"),d(10,"edit"),r()(),u(11,Pe,3,0,"button",23),r()()}if(n&2){let t,i=e.$implicit,o=l(2);F("highlighted",o.highlightedBrand()&&i.brand.toLowerCase()===o.highlightedBrand().toLowerCase()),c(3),D(i.brand),c(2),_((t=o.getCurrentFullPrice(i))?5:-1,t),c(),_(i.discountedPrice?6:-1),c(5),_(i.discountedPrice?11:-1)}}function Me(n,e){if(n&1&&(a(0,"h3"),d(1,"Price History"),r(),x(2,"pw-price-chart",25)),n&2){let t=l();c(2),M("supermarkets",t.supermarkets)}}function De(n,e){if(n&1){let t=b();a(0,"div",0),u(1,fe,4,1,"mat-form-field",2)(2,Ce,6,1,"div",3),a(3,"p",4),d(4),r(),a(5,"div",5),u(6,xe,7,2,"div",6),u(7,be,7,2,"div",7),r(),x(8,"mat-divider"),a(9,"h3"),d(10,"Prices by Supermarket"),r(),T(11,ye,12,6,"div",8,ge),a(13,"button",9),h("click",function(){m(t);let o=l();return p(o.addNewSupermarketPrice())}),a(14,"mat-icon"),d(15,"add"),r(),d(16," Add Supermarket "),r(),x(17,"mat-divider"),u(18,Me,3,1),r()}if(n&2){let t,i,o=e,s=l();c(),_(s.editingName()?1:2),c(3),D(o.barcode),c(2),_((t=s.cheapestFull())?6:-1,t),c(),_((i=s.cheapestDiscounted())?7:-1,i),c(4),V(s.sortedSupermarkets()),c(7),_(o.supermarkets.length>0?18:-1)}}function ke(n,e){n&1&&(a(0,"div",1)(1,"p"),d(2,"Product not found."),r()())}var le=class n{route=P(B);router=P($);storage=P(W);snackBar=P(q);barcode=y("");highlightedBrand=y("");editingName=y(!1);editNameValue=y("");product=C(()=>{let e=this.barcode();return e?this.storage.products().find(t=>t.barcode===e)??null:null});sortedSupermarkets=C(()=>{let e=this.product();return e?U(e.supermarkets):[]});cheapestFull=C(()=>{let e=this.product();return e?Z(e):null});cheapestDiscounted=C(()=>{let e=this.product();return e?J(e):null});formatCentsToEuro=Q;getCurrentFullPrice=K;ngOnInit(){this.barcode.set(this.route.snapshot.paramMap.get("barcode")??""),this.highlightedBrand.set(this.route.snapshot.queryParamMap.get("brand")??"")}startEditName(){this.editNameValue.set(this.product()?.name??""),this.editingName.set(!0)}saveName(){let e=this.editNameValue().trim();e&&(this.storage.updateProductName(this.barcode(),e),this.snackBar.open("Name updated","OK",{duration:2e3})),this.editingName.set(!1)}cancelEditName(){this.editingName.set(!1)}addNewSupermarketPrice(){this.router.navigate(["/product",this.barcode(),"edit"])}updatePrice(e){this.router.navigate(["/product",this.barcode(),"edit",e])}removeDiscount(e){this.storage.removeDiscountedPrice(this.barcode(),e),this.snackBar.open(`Discount removed for ${e}`,"OK",{duration:2e3})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["pw-product-detail"]],decls:2,vars:1,consts:[[1,"detail-page","page-content"],[1,"page-content"],["appearance","outline",1,"name-edit-field"],[1,"name-row"],[1,"barcode-label"],[1,"price-badges"],[1,"badge","full-badge"],[1,"badge","discount-badge"],[1,"sm-entry",3,"highlighted"],["mat-stroked-button","",1,"add-sm-btn",3,"click"],["matInput","","cdkFocusInitial","",3,"ngModelChange","keydown.enter","keydown.escape","blur","ngModel"],["mat-icon-button","","aria-label","Edit product name",3,"click"],[1,"badge-label"],[1,"badge-price"],[1,"badge-brand"],[1,"sm-entry"],[1,"sm-header"],[1,"sm-brand"],[1,"sm-prices"],[1,"full-price"],[1,"discounted-price"],[1,"sm-actions"],["mat-icon-button","","aria-label","Edit price",3,"click"],["mat-icon-button","","aria-label","Remove discount"],["mat-icon-button","","aria-label","Remove discount",3,"click"],[3,"supermarkets"]],template:function(t,i){if(t&1&&u(0,De,19,5,"div",0)(1,ke,3,0,"div",1),t&2){let o;_((o=i.product())?0:1,o)}},dependencies:[te,X,Y,ee,H,L,R,j,z,de,ce,ae,ie,ne,re,oe,G,E],styles:[".detail-page[_ngcontent-%COMP%]{max-width:500px;margin:0 auto}.name-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.name-row[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;flex:1}.name-edit-field[_ngcontent-%COMP%]{width:100%;margin-top:8px}.barcode-label[_ngcontent-%COMP%]{font-family:monospace;color:var(--mat-sys-on-surface-variant);margin-bottom:16px}.price-badges[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin:16px 0}.badge[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:12px;border-radius:12px}.badge[_ngcontent-%COMP%]   .badge-label[_ngcontent-%COMP%]{font-size:.75rem;text-transform:uppercase;letter-spacing:.05em}.badge[_ngcontent-%COMP%]   .badge-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700}.badge[_ngcontent-%COMP%]   .badge-brand[_ngcontent-%COMP%]{font-size:.875rem}.full-badge[_ngcontent-%COMP%]{background:var(--mat-sys-primary-container);color:var(--mat-sys-on-primary-container)}.discount-badge[_ngcontent-%COMP%]{background:var(--mat-sys-tertiary-container);color:var(--mat-sys-on-tertiary-container)}.sm-entry[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:12px;margin:4px 0;border-radius:8px;background:var(--mat-sys-surface-container-low)}.sm-entry.highlighted[_ngcontent-%COMP%]{background:var(--mat-sys-secondary-container);border-left:4px solid var(--mat-sys-primary)}.sm-header[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.sm-brand[_ngcontent-%COMP%]{font-weight:500}.sm-prices[_ngcontent-%COMP%]{display:flex;gap:12px}.full-price[_ngcontent-%COMP%]{color:var(--mat-sys-primary);font-weight:500}.discounted-price[_ngcontent-%COMP%]{color:var(--mat-sys-error);font-weight:500}.sm-actions[_ngcontent-%COMP%]{display:flex}.add-sm-btn[_ngcontent-%COMP%]{width:100%;margin:16px 0}mat-divider[_ngcontent-%COMP%]{margin:16px 0}"]})};export{le as ProductDetail};
