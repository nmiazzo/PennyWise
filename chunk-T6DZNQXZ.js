import{a as V,b as B}from"./chunk-FEHYXCHT.js";import"./chunk-RCNJYKON.js";import{a as N,b as T}from"./chunk-CZSGPQFT.js";import{b as O,c as k,l as D,m as A}from"./chunk-DCY57EI2.js";import"./chunk-S6TQN5V4.js";import{f as R}from"./chunk-V24SG72Y.js";import{J as I,K as P}from"./chunk-DPOEUPYJ.js";import{Db as E,Fb as p,Kb as x,Lb as M,Mb as w,Ra as l,Tb as n,Ub as f,Vb as C,_ as b,da as m,ea as d,eb as S,pa as _,rb as v,sb as y,wb as h,xb as t,yb as e,zb as u}from"./chunk-U2MXLZLO.js";var L=["fileInput"];function F(g,s){g&1&&(t(0,"p",12),n(1),e()),g&2&&(l(),f(s))}var j=class g{storage=b(R);snackBar=b(D);fileInput;importing=_(!1);importResult=_(null);get productCount(){return this.storage.products().length}get brandCount(){return this.storage.brands().length}get forceEan13(){return this.storage.forceEan13()}onForceEan13Change(s){this.storage.setForceEan13(s)}exportDatabase(){let s=this.storage.exportDatabase(),r=JSON.stringify(s,null,2),i=new Blob([r],{type:"application/json"}),a=URL.createObjectURL(i),o=document.createElement("a");o.href=a,o.download=`pennywise-backup-${new Date().toISOString().slice(0,10)}.json`,o.click(),URL.revokeObjectURL(a),this.snackBar.open("Database exported!","OK",{duration:2e3})}triggerImport(){this.fileInput.nativeElement.click()}async onFileSelected(s){let r=s.target,i=r.files?.[0];if(i){this.importing.set(!0),this.importResult.set(null);try{let a=await i.text(),o=JSON.parse(a);if(!Array.isArray(o.products)||!Array.isArray(o.brands))throw new Error("Invalid file format: missing products or brands array");let c=this.storage.importDatabase(o);this.importResult.set(`Import complete: ${c.productsAdded} added, ${c.productsUpdated} updated, ${c.brandsAdded} new brands`),this.snackBar.open("Import successful!","OK",{duration:3e3})}catch(a){this.importResult.set(`Import failed: ${a.message}`),this.snackBar.open("Import failed","OK",{duration:3e3})}finally{this.importing.set(!1),r.value=""}}}clearAllData(){confirm("Are you sure you want to delete ALL data? This cannot be undone.")&&(this.storage.clearAll(),this.snackBar.open("All data cleared","OK",{duration:2e3}))}static \u0275fac=function(r){return new(r||g)};static \u0275cmp=S({type:g,selectors:[["pw-settings"]],viewQuery:function(r,i){if(r&1&&x(L,5),r&2){let a;M(a=w())&&(i.fileInput=a.first)}},decls:53,vars:6,consts:[["fileInput",""],[1,"settings-page","page-content"],[1,"stats-section"],[1,"stat"],[1,"stat-value"],[1,"stat-label"],[1,"settings-section"],[3,"change","checked"],[1,"toggle-hint"],["mat-flat-button","",3,"click"],["mat-stroked-button","",3,"click","disabled"],["type","file","accept",".json,application/json",2,"display","none",3,"change"],[1,"import-result"],[1,"settings-section","danger-zone"],["mat-flat-button","","color","warn",3,"click"]],template:function(r,i){if(r&1){let a=E();t(0,"div",1)(1,"h2"),n(2,"Settings"),e(),t(3,"div",2)(4,"div",3)(5,"span",4),n(6),e(),t(7,"span",5),n(8,"Products"),e()(),t(9,"div",3)(10,"span",4),n(11),e(),t(12,"span",5),n(13,"Supermarkets"),e()()(),u(14,"mat-divider"),t(15,"section",6)(16,"h3"),n(17,"Scanner"),e(),t(18,"mat-slide-toggle",7),p("change",function(c){return m(a),d(i.onForceEan13Change(c.checked))}),n(19," Accept only EAN-13 barcodes (13 digits) "),e(),t(20,"p",8),n(21," When enabled, non-EAN-13 barcodes are automatically ignored. When disabled, you'll be asked whether to accept them. "),e()(),u(22,"mat-divider"),t(23,"section",6)(24,"h3"),n(25,"Export Data"),e(),t(26,"p"),n(27,"Download your entire database as a JSON file."),e(),t(28,"button",9),p("click",function(){return m(a),d(i.exportDatabase())}),t(29,"mat-icon"),n(30,"download"),e(),n(31," Export as JSON "),e()(),u(32,"mat-divider"),t(33,"section",6)(34,"h3"),n(35,"Import Data"),e(),t(36,"p"),n(37," Import a PennyWise JSON backup. Existing data will be merged (not overwritten). "),e(),t(38,"button",10),p("click",function(){return m(a),d(i.triggerImport())}),t(39,"mat-icon"),n(40,"upload"),e(),n(41),e(),t(42,"input",11,0),p("change",function(c){return m(a),d(i.onFileSelected(c))}),e(),v(44,F,2,1,"p",12),e(),u(45,"mat-divider"),t(46,"section",13)(47,"h3"),n(48,"Danger Zone"),e(),t(49,"button",14),p("click",function(){return m(a),d(i.clearAllData())}),t(50,"mat-icon"),n(51,"delete_forever"),e(),n(52," Clear All Data "),e()()()}if(r&2){let a;l(6),f(i.productCount),l(5),f(i.brandCount),l(7),h("checked",i.forceEan13),l(20),h("disabled",i.importing()),l(3),C(" ",i.importing()?"Importing...":"Import JSON File"," "),l(3),y((a=i.importResult())?44:-1,a)}},dependencies:[k,O,P,I,A,T,N,B,V],styles:[".settings-page[_ngcontent-%COMP%]{max-width:500px;margin:0 auto}.stats-section[_ngcontent-%COMP%]{display:flex;gap:24px;margin:16px 0}.stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.stat[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--mat-sys-primary)}.stat[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--mat-sys-on-surface-variant)}.settings-section[_ngcontent-%COMP%]{margin:16px 0}.settings-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:8px}.settings-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant);margin-bottom:12px}.toggle-hint[_ngcontent-%COMP%]{font-size:.8rem;margin-top:8px}.import-result[_ngcontent-%COMP%]{margin-top:12px;padding:8px 12px;border-radius:8px;background:var(--mat-sys-surface-container)}.danger-zone[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--mat-sys-error)}mat-divider[_ngcontent-%COMP%]{margin:16px 0}"]})};export{j as Settings};
