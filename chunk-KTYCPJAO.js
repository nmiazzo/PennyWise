import{a as B,b as N}from"./chunk-CZSGPQFT.js";import{b as C,c as I,l as P,m as A}from"./chunk-DCY57EI2.js";import"./chunk-S6TQN5V4.js";import{f as R}from"./chunk-TFOK2HCO.js";import{J as k,K as D}from"./chunk-DPOEUPYJ.js";import{Db as h,Fb as u,Kb as M,Lb as w,Mb as E,Ra as l,Tb as n,Ub as f,Vb as O,_ as b,da as d,ea as p,eb as _,pa as v,rb as S,sb as y,wb as x,xb as e,yb as t,zb as g}from"./chunk-U2MXLZLO.js";var T=["fileInput"];function j(m,s){m&1&&(e(0,"p",10),n(1),t()),m&2&&(l(),f(s))}var V=class m{storage=b(R);snackBar=b(P);fileInput;importing=v(!1);importResult=v(null);get productCount(){return this.storage.products().length}get brandCount(){return this.storage.brands().length}exportDatabase(){let s=this.storage.exportDatabase(),r=JSON.stringify(s,null,2),a=new Blob([r],{type:"application/json"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=`pennywise-backup-${new Date().toISOString().slice(0,10)}.json`,o.click(),URL.revokeObjectURL(i),this.snackBar.open("Database exported!","OK",{duration:2e3})}triggerImport(){this.fileInput.nativeElement.click()}async onFileSelected(s){let r=s.target,a=r.files?.[0];if(a){this.importing.set(!0),this.importResult.set(null);try{let i=await a.text(),o=JSON.parse(i);if(!Array.isArray(o.products)||!Array.isArray(o.brands))throw new Error("Invalid file format: missing products or brands array");let c=this.storage.importDatabase(o);this.importResult.set(`Import complete: ${c.productsAdded} added, ${c.productsUpdated} updated, ${c.brandsAdded} new brands`),this.snackBar.open("Import successful!","OK",{duration:3e3})}catch(i){this.importResult.set(`Import failed: ${i.message}`),this.snackBar.open("Import failed","OK",{duration:3e3})}finally{this.importing.set(!1),r.value=""}}}clearAllData(){confirm("Are you sure you want to delete ALL data? This cannot be undone.")&&(this.storage.clearAll(),this.snackBar.open("All data cleared","OK",{duration:2e3}))}static \u0275fac=function(r){return new(r||m)};static \u0275cmp=_({type:m,selectors:[["pw-settings"]],viewQuery:function(r,a){if(r&1&&M(T,5),r&2){let i;w(i=E())&&(a.fileInput=i.first)}},decls:45,vars:5,consts:[["fileInput",""],[1,"settings-page","page-content"],[1,"stats-section"],[1,"stat"],[1,"stat-value"],[1,"stat-label"],[1,"settings-section"],["mat-flat-button","",3,"click"],["mat-stroked-button","",3,"click","disabled"],["type","file","accept",".json,application/json",2,"display","none",3,"change"],[1,"import-result"],[1,"settings-section","danger-zone"],["mat-flat-button","","color","warn",3,"click"]],template:function(r,a){if(r&1){let i=h();e(0,"div",1)(1,"h2"),n(2,"Settings"),t(),e(3,"div",2)(4,"div",3)(5,"span",4),n(6),t(),e(7,"span",5),n(8,"Products"),t()(),e(9,"div",3)(10,"span",4),n(11),t(),e(12,"span",5),n(13,"Supermarkets"),t()()(),g(14,"mat-divider"),e(15,"section",6)(16,"h3"),n(17,"Export Data"),t(),e(18,"p"),n(19,"Download your entire database as a JSON file."),t(),e(20,"button",7),u("click",function(){return d(i),p(a.exportDatabase())}),e(21,"mat-icon"),n(22,"download"),t(),n(23," Export as JSON "),t()(),g(24,"mat-divider"),e(25,"section",6)(26,"h3"),n(27,"Import Data"),t(),e(28,"p"),n(29," Import a PennyWise JSON backup. Existing data will be merged (not overwritten). "),t(),e(30,"button",8),u("click",function(){return d(i),p(a.triggerImport())}),e(31,"mat-icon"),n(32,"upload"),t(),n(33),t(),e(34,"input",9,0),u("change",function(c){return d(i),p(a.onFileSelected(c))}),t(),S(36,j,2,1,"p",10),t(),g(37,"mat-divider"),e(38,"section",11)(39,"h3"),n(40,"Danger Zone"),t(),e(41,"button",12),u("click",function(){return d(i),p(a.clearAllData())}),e(42,"mat-icon"),n(43,"delete_forever"),t(),n(44," Clear All Data "),t()()()}if(r&2){let i;l(6),f(a.productCount),l(5),f(a.brandCount),l(19),x("disabled",a.importing()),l(3),O(" ",a.importing()?"Importing...":"Import JSON File"," "),l(3),y((i=a.importResult())?36:-1,i)}},dependencies:[I,C,D,k,A,N,B],styles:[".settings-page[_ngcontent-%COMP%]{max-width:500px;margin:0 auto}.stats-section[_ngcontent-%COMP%]{display:flex;gap:24px;margin:16px 0}.stat[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.stat[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:var(--mat-sys-primary)}.stat[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:.875rem;color:var(--mat-sys-on-surface-variant)}.settings-section[_ngcontent-%COMP%]{margin:16px 0}.settings-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:8px}.settings-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--mat-sys-on-surface-variant);margin-bottom:12px}.import-result[_ngcontent-%COMP%]{margin-top:12px;padding:8px 12px;border-radius:8px;background:var(--mat-sys-surface-container)}.danger-zone[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--mat-sys-error)}mat-divider[_ngcontent-%COMP%]{margin:16px 0}"]})};export{V as Settings};
