import{a as Z}from"./chunk-S4DDTBNE.js";import"./chunk-SNEV3XM5.js";import{a as ee,b as te}from"./chunk-FEHYXCHT.js";import"./chunk-RCNJYKON.js";import{a as W,d as J,e as Q,f as X,g as Y}from"./chunk-XPWQRXXX.js";import{a as L,c as R}from"./chunk-JYRBUVI2.js";import{b as P,c as k,l as H,m as U}from"./chunk-DCY57EI2.js";import"./chunk-S6TQN5V4.js";import{d as q,f as $,g as j,r as G}from"./chunk-V24SG72Y.js";import{J as z,K as M}from"./chunk-DPOEUPYJ.js";import{Db as C,Fb as c,Gb as m,Ra as l,Tb as d,U as S,Ub as w,Vb as f,Xb as O,Yb as V,_ as g,ac as I,cc as K,da as b,dc as A,ea as v,eb as _,pa as u,rb as N,sb as D,tb as T,ub as F,vb as B,wb as y,xb as n,yb as a,zb as E}from"./chunk-U2MXLZLO.js";var se=()=>[1,2,3,4,5,6,7,8,9];function de(o,e){if(o&1){let t=C();n(0,"button",5),c("click",function(){let r=b(t).$implicit,s=m();return v(s.pressDigit(r))}),d(1),a()}if(o&2){let t=e.$implicit;l(),f(" ",t," ")}}var x=class o{initialValue=A(0);valueCents=u(0);displayValue=I(()=>q(this.valueCents()));valueChanged=K();onChange=()=>{};onTouched=()=>{};writeValue(e){this.valueCents.set(e??0)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}pressDigit(e){let t=this.valueCents()*10+e;t>999999||(this.valueCents.set(t),this.emitChange())}pressBackspace(){this.valueCents.set(Math.floor(this.valueCents()/10)),this.emitChange()}pressClear(){this.valueCents.set(0),this.emitChange()}emitChange(){let e=this.valueCents();this.onChange(e),this.onTouched(),this.valueChanged.emit(e)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=_({type:o,selectors:[["pw-pos-keypad"]],inputs:{initialValue:[1,"initialValue"]},outputs:{valueChanged:"valueChanged"},features:[O([{provide:j,useExisting:S(()=>o),multi:!0}])],decls:13,vars:2,consts:[[1,"keypad-container"],["aria-live","polite",1,"price-display"],[1,"keypad-grid"],["mat-flat-button","","type","button",1,"keypad-btn","digit-btn"],["mat-flat-button","","type","button","aria-label","Clear",1,"keypad-btn","action-btn",3,"click"],["mat-flat-button","","type","button",1,"keypad-btn","digit-btn",3,"click"],["mat-flat-button","","type","button","aria-label","Backspace",1,"keypad-btn","action-btn",3,"click"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"div",1),d(2),a(),n(3,"div",2),F(4,de,2,1,"button",3,T),n(6,"button",4),c("click",function(){return i.pressClear()}),d(7," C "),a(),n(8,"button",5),c("click",function(){return i.pressDigit(0)}),d(9," 0 "),a(),n(10,"button",6),c("click",function(){return i.pressBackspace()}),n(11,"mat-icon"),d(12,"backspace"),a()()()()),t&2&&(l(2),f(" ",i.displayValue()," "),l(2),B(V(1,se)))},dependencies:[k,P,M,z],styles:[".keypad-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:16px;width:100%;max-width:320px;margin:0 auto}.price-display[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:500;text-align:center;padding:16px;width:100%;background:var(--mat-sys-surface-container);border-radius:12px;font-variant-numeric:tabular-nums}.keypad-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;width:100%}.keypad-btn[_ngcontent-%COMP%]{height:56px;font-size:1.25rem;border-radius:12px!important}.action-btn[_ngcontent-%COMP%]{background-color:var(--mat-sys-secondary-container)!important;color:var(--mat-sys-on-secondary-container)!important}"]})};function le(o,e){if(o&1){let t=C();n(0,"mat-form-field",1)(1,"mat-label"),d(2,"Product Name (optional)"),a(),n(3,"input",10),c("input",function(r){b(t);let s=m();return v(s.productName.set(r.target.value))}),a()()}if(o&2){let t=m();l(3),y("value",t.productName())}}function ce(o,e){if(o&1&&(n(0,"p",3),d(1),a()),o&2){let t=m();l(),w(t.productName())}}var ie=class o{route=g(L);router=g(R);storage=g($);snackBar=g(H);barcode=u("");isNewProduct=u(!1);preSelectedBrand=u("");productName=u("");brand=u("");priceCents=u(0);isDiscounted=u(!1);ngOnInit(){let e=this.route.snapshot.paramMap,t=this.route.snapshot.queryParamMap,i=this.route.snapshot.data,r=e.get("barcode")??"";this.barcode.set(r);let s=e.get("brand")??t.get("brand")??"";this.preSelectedBrand.set(s),this.brand.set(s);let h=this.storage.getProduct(r);if(!h||this.route.snapshot.url.some(p=>p.path==="new")?this.isNewProduct.set(!0):(this.isNewProduct.set(!1),this.productName.set(h.name)),i.mode==="edit-brand"&&h&&s){let p=h.supermarkets.find(ne=>ne.brand.toLowerCase()===s.toLowerCase());p&&p.fullPriceHistory.length>0&&this.priceCents.set(p.fullPriceHistory[p.fullPriceHistory.length-1].price)}}onPriceChanged(e){this.priceCents.set(e)}onBrandChanged(e){this.brand.set(e)}save(){let e=this.brand().trim(),t=this.priceCents();if(!e){this.snackBar.open("Please select a supermarket","OK",{duration:2e3});return}if(t<=0){this.snackBar.open("Please enter a price","OK",{duration:2e3});return}this.storage.addOrUpdatePrice(this.barcode(),e,t,this.isDiscounted(),this.isNewProduct()?this.productName()||this.barcode():void 0),this.snackBar.open("Price saved!","OK",{duration:1500}),this.router.navigate(["/product",this.barcode()])}cancel(){this.storage.getProduct(this.barcode())?this.router.navigate(["/product",this.barcode()]):this.router.navigate(["/scan"])}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=_({type:o,selectors:[["pw-product-form"]],decls:18,vars:5,consts:[[1,"form-page","page-content"],["appearance","outline",1,"full-width"],["matInput","","readonly","",3,"value"],[1,"product-name-display"],["label","Supermarket",3,"brandSelected"],[1,"discount-toggle",3,"change","checked"],[3,"valueChanged"],[1,"form-actions"],["mat-flat-button","","color","primary",1,"full-width",3,"click"],["mat-stroked-button","",1,"full-width",3,"click"],["matInput","","placeholder","e.g., Whole Milk 1L",3,"input","value"]],template:function(t,i){t&1&&(n(0,"div",0)(1,"h2"),d(2),a(),n(3,"mat-form-field",1)(4,"mat-label"),d(5,"Barcode"),a(),E(6,"input",2),a(),N(7,le,4,1,"mat-form-field",1)(8,ce,2,1,"p",3),n(9,"pw-brand-autocomplete",4),c("brandSelected",function(s){return i.onBrandChanged(s)}),a(),n(10,"mat-slide-toggle",5),c("change",function(s){return i.isDiscounted.set(s.checked)}),d(11," This is a sale/discounted price "),a(),n(12,"pw-pos-keypad",6),c("valueChanged",function(s){return i.onPriceChanged(s)}),a(),n(13,"div",7)(14,"button",8),c("click",function(){return i.save()}),d(15),a(),n(16,"button",9),c("click",function(){return i.cancel()}),d(17," Cancel "),a()()()),t&2&&(l(2),w(i.isNewProduct()?"New Product":"Update Price"),l(4),y("value",i.barcode()),l(),D(i.isNewProduct()?7:8),l(3),y("checked",i.isDiscounted()),l(5),f(" ",i.isNewProduct()?"Add Product":"Save Price"," "))},dependencies:[G,k,P,Q,J,W,Y,X,te,ee,M,U,x,Z],styles:[".form-page[_ngcontent-%COMP%]{max-width:400px;margin:0 auto}.full-width[_ngcontent-%COMP%]{width:100%}.product-name-display[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500;margin:8px 0 16px}.discount-toggle[_ngcontent-%COMP%]{display:block;margin:16px 0}.form-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-top:24px}"]})};export{ie as ProductForm};
